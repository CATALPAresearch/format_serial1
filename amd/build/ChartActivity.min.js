/**
 * ActivityChart
 *
 * @module     format/ladtopics
 * @package    format_ladtopics
 * @class      ActivityChart
 * @copyright  2020 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @license    MIT
 * @since      3.1
 */
define(["jquery"],(function(t){var e="",n=["#004C97","#004C97","#004C97","#004C97","#004C97","#004C97","#004C97"],i={viewed:"betrachtet",updates:"bearbeitet",deleleted:"gelÃ¶scht",created:"erstellt"},a={mod_forum:"Forum",mod_glossary:"Glossar",mod_wiki:"Wiki",mod_assignment:"Aufgabe",mod_studentquiz:"StudentQuiz",mod_quiz:"Quiz"},r=Object.keys(a),o=document.getElementById("ladtopic-container-0").offsetWidth,c=0,u=10,l=function(t,l,s,d,f,m,g){f=f.filter((function(t){return t.utc>=g.start&&t.utc<g.end})),e=l.bubbleChart("#timeline-chart"),this.chart=function(){return e},f.forEach((function(t,e){t.date=new Date(1e3*t.utc),t.action_type=r.indexOf(t.action_type)}));var y=s(f).dimension((function(t){return[t.date,t.action_type,t.action]})),h=y.group().reduce((function(t,e){return++t.count,t.date=e.date,t.action=e.action,t.action_type=e.action_type,t}),(function(t,e){return--t.count,t.date=e.date,t.action=e.action,t.action_type=e.action_type,t}),(function(){return{count:0,date:0,action:"",action_type:""}}));this.getGroup=function(){return h};var p=[t.min(h.all(),(function(t){return t.key[0]})),t.max(h.all(),(function(t){return t.key[0]}))];p[1]=d(p[1]).isSameOrBefore(new Date)?new Date:p[1],this.getXRange=function(){return p};for(var v=t.max(h.all(),(function(t){return t.value.count})),_=t.scaleOrdinal().domain(r).range(n),b=[],x=0;x<f.length;x++)b.push(f[x].action_type);b.filter((function(t,e,n){return n.indexOf(t)===e})).length;e.width(o).height(120).margins({top:10,bottom:20,left:u,right:c}).clipPadding(65).renderLabel(!1).minRadius(1).maxBubbleRelativeSize(.3).x(t.scaleTime().domain(p).range([0,o])).brushOn(!0).dimension(y).group(h).renderHorizontalGridLines(!0).keyAccessor((function(t){return t.value.date})).valueAccessor((function(t){return t.value.action_type})).radiusValueAccessor((function(t){return t.value.count/v})).colors(_).title((function(t){return["Am "+m.formatDate(t.value.date)," haben Sie "+m.numberToWord(t.value.count,"mal")," das "+a[r[t.value.action_type]]," "+i[t.value.action]].join("")})).xAxis(t.axisBottom().ticks(10)),this.update=function(n){e.x(t.scaleTime().domain(n)).selectAll("line.grid-line").attr("y2",e.effectiveHeight()).attr("opacity",.5),e.render()},e.selectAll(".axis.y .tick").attr("transform","translate(50,0)").style("transition-duration","0"),e.elasticY(!0).yAxisPadding(0).yAxis().ticks(6).tickFormat((function(t){if(t===Math.ceil(t))return a[r[t]]})),e.render(),e.on("pretransition",(function(){e.selectAll("line.grid-line").attr("y2",e.effectiveHeight()).attr("opacity",.5)})),e.on("renderlet",(function(e){var n=t.select("#timeline-chart svg");n.select("g.y").style("transition-duration","0").attr("transform","translate(35,10)"),n.selectAll("g.y g.tick text").attr("text-anchor","start").attr("class","timeline-y-label")}))};return window.onresize=function(t){o=document.getElementById("planing-component").offsetWidth,l&&l.chart&&(l.chart.width(o).transitionDuration(0),l.chart.group(l.getGroup()))},l}));