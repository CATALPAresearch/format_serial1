/**
 * FilterChart
 *
 * @module     format/ladtopics
 * @package    format_ladtopics
 * @class      Timeline
 * @copyright  2020 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @license    MIT
 * @since      3.1
 */
define(["jquery"],(function(e){var t="";return function(n,r,i,a,o,s,c,d,l){t=r.compositeChart("#filter-chart"),this.xRange=o,this.milestoneApp=s;for(var u=document.getElementById("ladtopic-container-0").offsetWidth,f=10,h=10,g=i([{date:l.startDate,y:1},{date:l.endDate,y:1}]).dimension((function(e){return e.date})),m=g.group().reduceCount((function(e){return[0,e.date,1]})),p=a.dimension((function(e){return e.date})),y=p.group().reduceCount((function(e){return e.date})),v=s.getMilestones(),x=0;x<v.length;x++)v[x].y=x%3+1;var w=i(v).dimension((function(e){return[e.status,e.end,e.y]})),b=w.group().reduceCount((function(e){return e.end}));t.width(u).height(85).margins({top:10,bottom:15,left:h-10,right:f}).compose([r.barChart(t).dimension(g).group(m),r.barChart(t).dimension(p).group(y).barPadding(0).gap(0).alwaysUseRounding(!0),r.bubbleChart(t).dimension(w).group(b).keyAccessor((function(e){return new Date(e.key[1])})).valueAccessor((function(e){return e.key[2]})).radiusValueAccessor((function(){return 1.4})).colors(n.scaleOrdinal().domain(["urgent","missed","progress","ready","refelcted"]).range(["#ffa500","ff420e","#80bd9e","#89da59","#004C97"])).colorAccessor((function(e){return e.key[0]})).renderLabel(!1).renderTitle(!1)]).x(n.scaleTime().domain(o).range([0,u])).elasticX(!0).elasticY(!0).xAxisLabel("",3),t.xAxis(n.axisTop().ticks(10)),t.xAxis().tickFormat(c.multiFormat),t.yAxisLabel("",10).yAxis().ticks(2),t.x(n.scaleTime().domain(o).range([0,u])),t.xAxis(n.axisBottom().ticks(10));var A=this;t.on("filtered",(function(){A.filterTime(A)})),t.on("renderlet",(function(e){n.select("#filter-chart svg rect.selection").on("mouseup",(function(){})),n.select("#filter-chart svg rect.selection").on("mousedown",(function(){})),n.select("#filter-chart svg rect.overlay").on("mousedown",(function(){d.add("timefilter_changed",{range:void 0===t.filters()[0]?this.xRange:t.filters()[0]})}))})),t.render(),n.select("#filter-chart svg").insert("g",":first-child").attr("transform","translate(0, 10)").append("rect",":first-child").attr("class","filter-background").attr("width","100%").attr("height",58),localStorage.surveyDone?(e(".activity-chart-container").show(),e(".filter-chart-container").show()):(e(".activity-chart-container").hide(),e(".filter-chart-container").hide());A=this;window.onresize=function(e){u=document.getElementById("planing-component").offsetWidth,t.width(u),A.filterTime(),t.render()},this.replaceFilter=function(e){t.replaceFilter(e)},this.filterTime=function(e){var n=void 0===t.filters()[0]?this.xRange:t.filters()[0];n[0]=n[0].getTime()<=1e3*l.start||n[0].getTime()>1e3*l.end?new Date(1e3*l.start):n[0],n[1]=n[1].getTime()>1e3*l.end?new Date(1e3*l.end):n[1],A.milestoneApp.updateChart(n);for(var r=0;r<C.length;r++)C[r].update(n);d.add("timefilter_changed",{range:n})};var C=[];this.registerChart=function(e){C.push(e)}}}));