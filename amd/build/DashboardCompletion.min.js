/**
 * DashboardCompletion
 *
 * @module     format/ladtopics
 * @package    format_ladtopics
 * @class      DashboardCompletion
 * @copyright  2020 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @description Shows per course section a row of rectangles indicating the completion of assigned activities.
 * @license    MIT
 * @since      3.1
 * 
 * @todo
 * - display repetition of activities
 * - provide additional information for each activity using a popover or tooltip
 * - fix empty section names
 */
define(["jquery",M.cfg.wwwroot+"/course/format/ladtopics/lib/build/vue.min.js",M.cfg.wwwroot+"/course/format/ladtopics/amd/src/utils/Utils.js"],(function(e,n,t){return t=new t,n.component("dashboard-completion",{props:["course"],data:function(){return{sections:[],info:"",current:{id:0,section:0}}},mounted:function(){var e=this;t.get_ws("completionprogress",{courseid:parseInt(this.course.id,10)},(function(n){try{e.draw(JSON.parse(n.completions))}catch(n){console.error(n)}}))},methods:{draw:function(e){this.sections=function(e,n){var t=[];for(var i in e)t[e[i][n]]=t[e[i][n]]||[],t[e[i][n]].push(e[i]);return t.filter((function(e){return null!==e}))}(e,"section")},setCurrent:function(e,n){this.current={id:e,section:n}},getCurrent:function(){return this.sections[this.current.section][this.current.id]},getLink:function(e){return"/mod/"+(e=null==e?this.getCurrent():e).type+"/view.php?id="+e.id},getStatus:function(e){return 0===(e=null==e?this.getCurrent():e).completion?'<i class="fa fa-times-square"></i>Nicht abgeschlossen':'<i class="fa fa-check"></i> Abgeschlossen'}},template:'\n                <div id="dashboard-completion">\n                    <p class="w-75" style="font-size:0.9em">Anhand dieser Balken können Sie erkennen, welche Lernangebote Sie bereits genutzt haben. Jedes Kästchen steht für ein Lernangebot, welches Sie durch einen Klick aufrufen können.</p>\n                    <div v-for="(section, sIndex) in sections" class="row">\n                        <div class="col-3" style="font-size:0.9em">{{ section[0].sectionname }}</div>\n                        <div class="col-9">\n                            <a v-bind:href="getLink()" v-for="(m, index) in section" :class="m.completion==1 ? \'rect-green completion-rect\' : \'rect-blue completion-rect\'" @mouseover="setCurrent(index, sIndex)"></a>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-3"></div>\n                        <div class="col-9">\n                            <a v-bind:href="getLink()">\n                                <span v-if="getCurrent().completion === 0"><i class="fa fa-times-rectangle"></i> {{ getCurrent().name }}, nicht abgeschlossen</span>\n                                <span v-if="getCurrent().completion !== 0"><i class="fa fa-check"></i> {{ getCurrent().name }}, abgeschlossen</span>\n                            </a>\n                        </div>\n                    </div>\n                </div>'})}));