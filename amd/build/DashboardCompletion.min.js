/**
 * DashboardCompletion
 *
 * @module     format/ladtopics
 * @package    format_ladtopics
 * @class      DashboardCompletion
 * @copyright  2020 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @description Shows per course section a row of rectangles indicating the completion of assigned activities.
 * @license    MIT
 * @since      3.1
 * 
 * @todo
 * - display repetition of activities
 * - provide additional information for each activity using a popover or tooltip
 * - fix empty section names
 */
define(["jquery",M.cfg.wwwroot+"/course/format/ladtopics/lib/build/vue.min.js",M.cfg.wwwroot+"/course/format/ladtopics/amd/src/Utils.js"],(function(n,e,t){return t=new t,e.component("dashboard-completion",{props:["course"],data:function(){return{sections:[],info:"",current:{id:0,section:0}}},mounted:function(){var n=this;t.get_ws("completionprogress",{courseid:parseInt(this.course.id,10)},(function(e){try{n.draw(JSON.parse(e.completions))}catch(e){console.error(e)}}))},methods:{draw:function(n){this.sections=function(n,e){var t=[];for(var i in n)t[n[i][e]]=t[n[i][e]]||[],t[n[i][e]].push(n[i]);return t.filter((function(n){return null!==n}))}(n,"section")},setCurrent:function(n,e){this.current={id:n,section:e}},getCurrent:function(){return this.sections[this.current.section][this.current.id]},getLink:function(n){return"/mod/"+(n=null==n?this.getCurrent():n).type+"/view.php?id="+n.id},getStatus:function(n){return 0===(n=null==n?this.getCurrent():n).completion?'<i class="fa fa-times-square"></i>Nicht abgeschlossen':'<i class="fa fa-check"></i> Abgeschlossen'}},template:'\n                <div id="dashboard-completion">\n                    <div v-for="(section, sIndex) in sections" class="row">\n                        <div class="col-3">{{ section[0].sectionname }}</div>\n                        <div class="col-9">\n                            <a v-bind:href="getLink()" v-for="(m, index) in section" :class="m.completion==1 ? \'rect-green completion-rect\' : \'rect-blue completion-rect\'" @mouseover="setCurrent(index, sIndex)"></a>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-3"></div>\n                        <div class="col-9">\n                            <a v-bind:href="getLink()">\n                                <span v-if="getCurrent().completion === 0"><i class="fa fa-times-rectangle"></i> {{ getCurrent().name }}, nicht abgeschlossen</span>\n                                <span v-if="getCurrent().completion !== 0"><i class="fa fa-check"></i> {{ getCurrent().name }}, abgeschlossen</span>\n                            </a>\n                        </div>\n                    </div>\n                </div>'})}));