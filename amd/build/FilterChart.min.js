define(["jquery"],function(a){var b="",c=function(c,d,e,f,g,h,i,j,k){b=d.compositeChart("#filter-chart"),this.xRange=g,this.milestoneApp=h;for(var l=document.getElementById("ladtopic-container-0").offsetWidth,m={top:15,right:10,bottom:20,left:10},n=["#ffa500","ff420e","#80bd9e","#89da59","#004C97"],o=e([{date:k.startDate,y:1},{date:k.endDate,y:1}]),p=o.dimension(function(a){return a.date}),q=p.group().reduceCount(function(a){return[0,a.date,1]}),r=f.dimension(function(a){return a.date}),s=r.group().reduceCount(function(a){return a.date}),t=h.getMilestones(),u=0;u<t.length;u++)t[u].y=u%3+1;var v=e(t),w=v.dimension(function(a){return[a.status,a.end,a.y]}),x=w.group().reduceCount(function(a){return a.end});b.width(l).height(85).margins({top:10,bottom:15,left:m.left-10,right:m.right}).compose([d.barChart(b).dimension(p).group(q),d.barChart(b).dimension(r).group(s).barPadding(0).gap(0).alwaysUseRounding(!0),d.bubbleChart(b).dimension(w).group(x).keyAccessor(function(a){return new Date(a.key[1])}).valueAccessor(function(a){return a.key[2]}).radiusValueAccessor(function(){return 1.4}).colors(c.scaleOrdinal().domain(["urgent","missed","progress","ready","refelcted"]).range(n)).colorAccessor(function(a){return a.key[0]}).renderLabel(!1).renderTitle(!1)]).x(c.scaleTime().domain(g).range([0,l])).elasticX(!0).elasticY(!0).xAxisLabel("",3),b.xAxis(c.axisTop().ticks(10)),b.xAxis().tickFormat(i.multiFormat),b.yAxisLabel("",10).yAxis().ticks(2),b.x(c.scaleTime().domain(g).range([0,l])),b.xAxis(c.axisBottom().ticks(10));var y=this;b.on("filtered",function(){y.filterTime(y)}),b.on("renderlet",function(a){c.select("#filter-chart svg rect.selection").on("mouseup",function(){}),c.select("#filter-chart svg rect.selection").on("mousedown",function(){}),c.select("#filter-chart svg rect.overlay").on("mousedown",function(){j.add("timefilter_changed",{range:void 0===b.filters()[0]?this.xRange:b.filters()[0]})})}),b.render();var z=c.select("#filter-chart svg");z.insert("g",":first-child").attr("transform","translate(0, 10)").append("rect",":first-child").attr("class","filter-background").attr("width","100%").attr("height",58),localStorage.surveyDone?(a(".activity-chart-container").show(),a(".filter-chart-container").show()):(a(".activity-chart-container").hide(),a(".filter-chart-container").hide());var y=this;window.onresize=function(a){l=document.getElementById("planing-component").offsetWidth,b.width(l),y.filterTime(),b.render()},this.replaceFilter=function(a){b.replaceFilter(a)},this.filterTime=function(a){var c=void 0===b.filters()[0]?this.xRange:b.filters()[0];c[0]=c[0].getTime()<=1e3*k.start||c[0].getTime()>1e3*k.end?new Date(1e3*k.start):c[0],c[1]=c[1].getTime()>1e3*k.end?new Date(1e3*k.end):c[1],y.milestoneApp.updateChart(c);for(var d=0;d<A.length;d++)A[d].update(c);j.add("timefilter_changed",{range:c})};var A=[];this.registerChart=function(a){A.push(a)}};return c});