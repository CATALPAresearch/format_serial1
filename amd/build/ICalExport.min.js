define(["jquery","core/ajax"],function(a,b){var c,d={InvalidConfigData:"ICalExport: Falsche Konfiguration des Kalenders",InvalidEventData:"ICalExport: Falsche Konfiguration des Ereignisses",InvalidAlarmData:"ICalExport: Falsche Konfiguration des Alarms"};return function(a){a[a.DISPLAY=0]="DISPLAY",a[a.EMAIL=1]="EMAIL"}(c||(c={})),function(){function a(a,b){if(!this.valConfigData(b))throw new Error(d.InvalidConfigData);this._config=b,this._ICalLib=a,this._cal=new a.Component(["vcalendar",[],[]]);var c=new a.Component("vtimezone"),e=new a.Timezone.fromData({component:c,tzid:b.tzid});c.updatePropertyWithValue("tzid",e.toString());var f=new a.Component("daylight");f.addPropertyWithValue("dtstart",new a.Time({year:1996,month:3,day:31,hour:2})),f.addPropertyWithValue("tzoffsetfrom","+01:00"),f.addPropertyWithValue("tzoffsetto","+02:00"),f.addPropertyWithValue("tzname","cest"),f.addPropertyWithValue("rrule",new a.Recur({freq:"YEARLY",bymonth:3,byday:"-1SU"})),c.addSubcomponent(f);var g=new a.Component("standard");g.addPropertyWithValue("dtstart",new a.Time({year:1996,month:10,day:27,hour:3})),g.addPropertyWithValue("tzname","cet"),g.addPropertyWithValue("tzoffsetfrom","+02:00"),g.addPropertyWithValue("tzoffsetto","+01:00"),g.addPropertyWithValue("rrule",new a.Recur({freq:"YEARLY",bymonth:10,byday:"-1SU"})),c.addSubcomponent(g),this._cal.addSubcomponent(c),this._cal.updatePropertyWithValue("prodid",b.prodid),this._cal.updatePropertyWithValue("version",b.version),this._cal.calscale=b.type.toUpperCase()}return a.prototype.print=function(){return this._cal.toString()},a.prototype.valConfigData=function(a){return"object"==typeof a&&(!("string"!=typeof a.prodid||a.prodid.length<=0)&&(!("string"!=typeof a.version||a.version.length<=0)&&(!("string"!=typeof a.type||a.type.length<=0)&&(!("string"!=typeof a.domain||a.domain.length<=0)&&!("string"!=typeof a.tzid||a.tzid.length<=0)))))},a.prototype.addEvent=function(a){if(!this.valEventData(a))throw new Error(d.InvalidEventData);var b=new this._ICalLib.Component("vevent"),c=new this._ICalLib.Event(b);return b.addPropertyWithValue("dtstamp",this._ICalLib.Time.now()),c.uid=a.uid+"@"+this._config.domain,c.startDate=this._ICalLib.Time.fromJSDate(a.start),a.end&&(c.endDate=this._ICalLib.Time.fromJSDate(a.end)),c.description=this._encode_utf8(a.description),c.summary=this._encode_utf8(a.title),a.location&&(c.location=this._encode_utf8(a.location)),this._cal.addSubcomponent(b),b},a.prototype.valEventData=function(a){return"object"==typeof a&&(("string"==typeof a.uid||"number"==typeof a.uid)&&("object"==typeof a.start&&a.start instanceof Date&&(("object"==typeof a.end||"undefined"==typeof a.end)&&(("object"!=typeof a.end||a.end instanceof Date)&&("string"==typeof a.description&&("string"==typeof a.location||"undefined"==typeof a.location))))))},a.prototype.addAlarm=function(a,b){if(!this.valAlarmData(b))throw new Error(d.InvalidAlarmData);var e=new this._ICalLib.Component("valarm");return e.addPropertyWithValue("action",c[b.type]),b.type===c.EMAIL&&"undefined"!=typeof b.attendee&&("string"==typeof b.attendee?e.addPropertyWithValue("attendee","MAILTO:"+b.attendee):b.attendee.forEach(function(a){e.addPropertyWithValue("attendee","MAILTO:"+a)})),e.addPropertyWithValue("dtstamp",this._ICalLib.Time.now()),e.addPropertyWithValue("trigger",this._ICalLib.Time.fromJSDate(b.date)),b.title&&e.addPropertyWithValue("summary",this._encode_utf8(b.title)),e.addPropertyWithValue("description",this._encode_utf8(b.description)),a.addSubcomponent(e),e},a.prototype.valAlarmData=function(a){return"object"==typeof a&&("number"==typeof a.type&&((a.type!==c.EMAIL||"string"==typeof a.attendee||"object"==typeof a.attendee)&&(a.date instanceof Date&&("string"==typeof a.description&&("string"==typeof a.title||"undefined"==typeof a.title)))))},a.prototype._encode_utf8=function(a){return unescape(encodeURIComponent(a.replace(/  +/g,"")))},a}()});