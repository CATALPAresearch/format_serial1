define(["jquery"],function(a){var b=function(b,c,d,e,f){new b({el:"#planningsurvey",data:function(){return{modalSurveyVisible:!1,surveyComplete:!1,objectives:"",availableTime:0,planingStyle:"",selectedMonth:0,selectedYear:0,resources:[],availableResources:[],invalidAvailableTime:!1,invalidObjective:!1,invalidResources:!1,invalidPlaningStyle:!1}},mounted:function(){var b=this;e.get_ws("coursestructure",{courseid:parseInt(f.id,10)},function(a){try{b.availableResources=JSON.parse(a.data)}catch(a){console.error(a)}}),e.get_ws("userpreferences",{data:{setget:"get",fieldname:"ladtopics_survey_done"}},function(c){try{c=JSON.parse(c.response),b.surveyComplete=parseInt(c[0].value,10)>0,d.surveyDone=parseInt(c[0].value,10),d.surveyDone>0&&a("#planing-component").show()}catch(c){console.error("Could not fetch user_preferences: ",c)}})},created:function(){a("#planningsurvey").show()},methods:{showModal:function(a){this.modalSurveyVisible=!0},closeModal:function(a){this.modalSurveyVisible=!1},monthRange:function(){return e.monthRange},yearRange:function(){return[2019,2020,2021,2022]},monthSelected:function(a){this.selectedMonth=a.target.value},yearSelected:function(a){this.selectedYear=a.target.value},resourcesBySection:function(a){return this.availableResources.filter(function(b){return parseInt(b.section_id,10)===parseInt(a,10)})},resourceSections:function(){for(var a={},b=0;b<this.availableResources.length;b++)a[this.availableResources[b].section_id]={name:" "===this.availableResources[b].section_name?"(Einführung)":this.availableResources[b].section_name,id:this.availableResources[b].section_id};return a},resourceById:function(a){return this.availableResources.filter(function(b){return parseInt(b.id,10)===parseInt(a,10)})[0]},resourceSelected:function(a){this.resources.push(this.resourceById(a.target.value));var b=document.getElementById("selected_resources");c.create(b,{});this.invalidResources=!(this.resources.length>0)},resourceRemove:function(a){for(var b=0;b<this.resources.length;b++)this.resources[b].id===a&&this.resources.splice(b,1);this.invalidResources=!(this.resources.length>0)},updateObjective:function(a){this.invalidObjective=""===this.objectives},updateAvailableTime:function(){this.invalidAvailableTime=this.availableTime<=0},updatePlaningStyle:function(a){this.invalidPlaningStyle=""===this.planingStyle},validateSurveyForm:function(){var a=!0;""===this.objectives&&(this.invalidObjective=!0,a=!1),this.availableTime<=0&&(this.invalidAvailableTime=!0,a=!1),""===this.planingStyle&&(this.invalidPlaningStyle=!0,a=!1),"f1c"===this.objectives&&0===this.resources.length&&this.availableResources.length>0&&(this.invalidResources=!0,a=!1),a&&this.saveSurvey()},saveSurvey:function(){var b=new Date,c={},f={};switch(this.objectives){case"f1a":f=Object.assign({},c,{}),f.name="Prüfung / Klausur",f.objective="Die Prüfung sehr gut bestehen",this.selectedMonth!==b.getMonth()&&this.selectedYear!==b.getFullYear()?f.end=Date.parse(""+this.selectedYear+","+this.selectedMonth+",1"):f.end=Date.parse("2020,2,1"),f.resources=[],f.strategies=[],d.addMilestone(f);break;case"f1b":;break;case"f1c":break;case"f1d":}var g=this;e.get_ws("userpreferences",{data:{setget:"set",fieldname:"ladtopics_survey_done",value:1}},function(b){try{b=JSON.parse(b.response),d.surveyDone=1,this.surveyComplete=!0,a("#theSurveyModal").modal("hide"),a("#planing-component").show(),e.get_ws("userpreferences",{data:{setget:"set",fieldname:"ladtopics_survey_results",value:JSON.stringify({objectives:g.objectives,availableTime:g.availableTime,planingStyle:g.planingStyle,selectedMonth:g.selectedMonth,selectedYear:g.selectedYear,resources:g.resources})}},function(a){})}catch(b){console.error("Could not fetch user_preferences: ",b)}})}}})};return b});