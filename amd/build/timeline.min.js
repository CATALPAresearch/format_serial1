define(["jquery","core/ajax"],function(a,b){var c=function(b,c,d,e,f,g,h,i,j,k){var l=document.getElementById("planing-component").offsetWidth,m={top:15,right:10,bottom:20,left:10},n={id:a("#courseid").text()};h.get_ws("logstore",{courseid:parseInt(n.id,10)},function(a){try{o(JSON.parse(a.data))}catch(a){console.error(a)}});var o=function(o){var p=new j(c,d,e,f,o,h),q=p.getXRange(),r=new b({el:"#planing-component",components:{},data:function(){return{surveyDone:!1,chart:"",timeFilterChart:"",xAxis:"",yAxis:"",x_axis_call:"",y_axis_call:"",colors:["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"],bars:"",barwidth:80,barheight:21,bardist:3,width:730,height:70,margins:{},padding:100,xmin:0,xmax:0,ymin:0,ymax:3,done:[],range:[],milestones:[{id:3867650,name:"Planung",objective:"Mein Semester planen",start:"2019,9,1",end:"2019,10,1",status:"urgent",progress:1,resources:[],strategies:[],reflections:[]},{id:0,name:"Lesen",objective:"Die Kurstexte lesen",start:"2019,9,1",end:"2019,9,7",status:"urgent",progress:1,resources:[],strategies:[],reflections:[]},{id:1,name:"Tests",objective:"Alle Tests bestehen",start:"2020,1,15",end:"2020,2,15",status:"progress",progress:.8,resources:[],strategies:[],reflections:[]}],emptyMilestone:{id:10,name:"",objective:"",start:"",end:"",status:"progress",progress:0,resources:[],strategies:[],reflections:[]},invalidName:!1,invalidObjective:!1,invalidResources:!1,selectedDay:1,selectedMonth:1,selectedYear:2019,dayInvalid:!1,filterPreset:"",selectedMilestone:0,modalVisible:!1,reflectionsFormVisisble:!1,strategies:[{id:"mindmap",name:"Mindmap",desc:"Eine Mindmap hilft dabei, Zusammenhänge darzustellen.",url:"http://www.heise.de/",category:"organization"},{id:"exzerpte",name:"Exzerpt",desc:"Ein Exzerpt ist mehr als nur eine einfache Zusammenfassung der wichtigsten Inhalte.",url:"http://www.heise.de/",category:"organization"},{id:"gliederung",name:"Gliederung",desc:"Themenfelder lassen sich mit einer Gliederung übersichtlich strukturieren.",url:"http://www.heise.de/",category:"organization"},{id:"strukturierung",name:"Strukturierung von Wissen",desc:"Fachausdrücke oder Definitionen lassen sich gut in Listen oder Tabellen sammeln.",url:"http://www.heise.de/",category:"organization"},{id:"transfer",name:"Übertragung von neuem Wissen auf bekannte Schemata",desc:"Neues Wissen kann durch die Verknüpfung mit dem eigenen Erleben leichter veranschaulicht und gelernt werden.",url:"http://www.heise.de/",category:"elaboration"},{id:"examples",name:"Beispiel aus dem Alltag/Arbeitsumfeld für neue Schemata",desc:"Ein Beispiel aus dem eigenen Umfeld hilft dabei, neue Wissensschemata schneller zu lernen.",url:"http://www.heise.de/",category:"elaboration"},{id:"critical",name:"kritisches Hinterfragen",desc:"Durch kritisches Hinterfragen kann man seine Aufmerksamkeit beim Lesen steigern.",url:"http://www.heise.de/",category:"elaboration"},{id:"structuring",name:"Bezug zu anderen Fächern herstellen",desc:"Bekanntes Wissen und Bezüge zu anderen Kursen erleichtern das Verständnis von Zusammenhängen.",url:"http://www.heise.de/",category:"elaboration"},{id:"pq4r",name:"PQ4R-Methode",desc:"Hinter dem Kürzel verstecken sich sechs Schritte: (1) Preview – Übersicht gewinnen; (2) Questions – Fragen an den Text stellen;  (3) Read – Zweiter Leseschritt - Gründliches Lesen des Textes; (4) Reflect – Gedankliche Auseinandersetzung mit dem Text; (5) Recite – Wiederholen und aus dem Gedächtnis Verfassen; (6) Review – Rückblick und Überprüfung",url:"http://www.heise.de/",category:"elaboration"},{id:"flashcards",name:"Systematisches Wiederholen mit der Lernkartei",desc:"Mit Lernkarten kann man Dinge systematisch wiederholen bis alles für die Prüfung sitzt. ",url:"http://www.heise.de/",category:"repeatition"},{id:"repeatition",name:"Repetieren",desc:"Mit vielen Wiederholungen festigt sich das Wissen. ",url:"http://www.heise.de/",category:"repeatition"},{id:"assoc",name:"Eselsbrücken als Erinnerungshilfe",desc:"Mit einem Reim oder einer Eselsbrücke kann man sich Begriffe oder Reihenfolgen leichter merken.",url:"http://www.heise.de/",category:"repeatition"},{id:"loci",name:"Loci Methode",desc:"Bei der Loci Methode verknüpft man Lerninhalte mit Orten oder Gegenständen. Für Abfolgen übt man eine Strecke/einen Spaziergang ein.",url:"http://www.heise.de/",category:"repeatition"}],resources:[]}},mounted:function(){var a=this;localStorage.milestones&&(this.milestones=JSON.parse(localStorage.milestones)),localStorage.surveyDone&&(this.surveyDone=localStorage.surveyDone),this.emptyMilestone.end=new Date,this.updateMilestoneStatus(),this.initializeChart(),window.addEventListener("keyup",function(b){27===b.keyCode&&this.modalVisible&&a.closeModal()});var b=e(o);this.timeFilterChart=new i(c,d,e,b,q,this,p,h)},created:function(){},watch:{milestones:function(a){localStorage.milestones=JSON.stringify(a)},surveyDone:function(a){localStorage.surveyDone=a}},methods:{getMoodlePath:function(){return M.cfg.wwwroot},initializeChart:function(){var a=this;this.range=q,this.selectedDay=(new Date).getDate(),this.selectedMonth=(new Date).getMonth()+1,this.selectedYear=(new Date).getFullYear(),h.get_ws("coursestructure",{courseid:parseInt(n.id,10)},function(b){try{a.resources=JSON.parse(b.data)}catch(b){console.error(b)}}),this.margins=m,this.width=l,this.milestones.forEach(function(a,b){a.start=new Date(a.start),a.end=new Date(a.end),a.g=1}),this.xmin=c.min(this.milestones,function(a){return a.start}),this.xmax=c.max(this.milestones,function(a){return a.end}),this.ymax=3;var b=c.scaleTime().domain(this.range).range([0,this.width-this.padding]),d=c.scaleLinear().domain([0,this.ymax]).range([0,this.height]);c.scaleOrdinal().range(this.colors);this.xAxis=c.axisTop().scale(b).ticks(10).tickFormat(h.multiFormat),this.yAxis=c.axisLeft().scale(d).ticks(0),this.chart=c.select(".chart.ms-chart .milestone-chart-container svg g"),this.x_axis_call=this.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.y_axis_call=this.chart.append("g").attr("class","y axis").call(this.yAxis),this.updateChart(this.range)},getMilestones:function(){return this.milestones},xx:function(a){var b=c.scaleTime().domain(this.range).range([0,this.width-this.padding])(a);return b},z:function(){return c.scaleOrdinal().range(this.colors)},getYLane:function(a){return a%3},updateChart:function(a){this.range=a,this.x_axis_call.transition().duration(500).call(this.xAxis.scale(c.scaleTime().domain(this.range).range([0,this.width-this.padding])).ticks(10).tickFormat(h.multiFormat)),this.y_axis_call.transition().duration(0).call(this.yAxis.scale(c.scaleLinear().domain([0,this.ymax]).range([0,this.height]))),this.$forceUpdate()},showModal:function(a){this.reflectionsFormVisisble="reflected"===this.getSelectedMilestone().status,this.selectedMilestone=a,this.modalVisible=!0},closeModal:function(b){this.modalVisible=!1,this.updateMilestoneStatus(),this.updateChart(this.range);for(var c=0;c<this.getSelectedMilestone().resources.length;c++)console.log(this.getSelectedMilestone().resources[c].instance_url_id),a("#module-"+this.getSelectedMilestone().resources[c].instance_url_id).addClass("resource-highlight")},getSelectedMilestone:function(){if(this.selectedMilestone===-1)return this.emptyMilestone;var a=this;return this.milestones.filter(function(b){return b.id===a.selectedMilestone})[0]},showEmptyMilestone:function(a){this.selectedMilestone=-1,this.modalVisible=!0},updateName:function(a){this.invalidName=""===this.getSelectedMilestone().name},updateObjective:function(a){this.invalidObjective=""===this.getSelectedMilestone().objective},validateMilestoneForm:function(){var a=!0;0===this.getSelectedMilestone().name.length&&(this.invalidName=!0,a=!1),0===this.getSelectedMilestone().objective.length&&(this.invalidObjective=!0,a=!1),0===this.getSelectedMilestone().resources.length&&this.resources.length>0&&(this.invalidResources=!0,a=!1),a&&this.createMilestone()},addMilestone:function(a){a.end=new Date(a.end),a.start=new Date(a.start),this.milestones.push(a),this.updateMilestoneStatus(),this.updateChart(this.range),this.$forceUpdate(),console.log(this.milestones)},createMilestone:function(b){this.emptyMilestone.id=Math.ceil(1e3*Math.random()),this.emptyMilestone.end=new Date(this.selectedYear,this.selectedMonth-1,this.selectedDay);var d=new Date;this.emptyMilestone.start=new Date(d.getFullYear()+"/"+d.getMonth()+"/"+d.getDate()),this.milestones.push(this.emptyMilestone);c.scaleTime().domain(this.range).range([0,l]),c.scaleLinear().domain([0,this.ymax]).range([0,this.height]);this.updateMilestoneStatus(),this.updateChart(this.range),this.emptyMilestone={id:10,name:"",objective:"",start:new Date,end:new Date,status:"progress",progress:0,resources:[],strategies:[],reflections:[]},a("#theMilestoneModal").modal("hide")},removeMilestone:function(){this.closeModal(),a("div.modal-backdrop.show").remove();for(var b=0;b<this.milestones.length;b++)this.milestones[b].id===this.selectedMilestone&&(this.milestones.splice(b,1),this.selectedMilestone=-1)},daySelected:function(a){return[4,6,9,11].indexOf(this.selectedMonth)!==-1&&31===a.target.value?void(this.dayInvalid=!0):2===this.selectedMonth&&a.target.value>29?void(this.dayInvalid=!0):2!==this.selectedMonth||29!==a.target.value||this.selectedYear%4===0&&this.selectedYear%100!==0||this.selectedYear%400===0?(this.dayInvalid=!1,this.selectedDay=a.target.value,void(this.getSelectedMilestone().end=new Date(this.selectedYear,this.selectedMonth-1,this.selectedDay))):void(this.dayInvalid=!0)},monthSelected:function(a){this.selectedMonth=a.target.value,this.getSelectedMilestone().end=new Date(this.selectedYear,this.selectedMonth-1,this.selectedDay)},yearSelected:function(a){this.selectedYear=a.target.value,this.getSelectedMilestone().end=new Date(this.selectedYear,this.selectedMonth-1,this.selectedDay)},dayRange:function(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]},monthRange:function(){return h.monthRange},yearRange:function(){return[2019,2020]},strategiesByCategory:function(a){return this.strategies.filter(function(b){return b.category===a})},strategyById:function(a){return this.strategies.filter(function(b){return b.id===a})[0]},resourceById:function(a){return this.resources.filter(function(b){return parseInt(b.id,10)===parseInt(a,10)})[0]},strategySelected:function(a){var b=this.strategyById(a.target.value);this.getSelectedMilestone().strategies.indexOf(b)===-1&&this.getSelectedMilestone().strategies.push(b)},strategyRemove:function(a){for(var b=0;b<this.getSelectedMilestone().strategies.length;b++)this.getSelectedMilestone().strategies[b].id===a&&this.getSelectedMilestone().strategies.splice(b,1)},resourceSelected:function(a){var b=this.resourceById(a.target.value);this.getSelectedMilestone().resources.indexOf(b)===-1&&this.getSelectedMilestone().resources.push(b),this.invalidResources=!(this.getSelectedMilestone().resources.length>0)},resourceRemove:function(a){for(var b=0;b<this.getSelectedMilestone().resources.length;b++)this.getSelectedMilestone().resources[b].id===a&&this.getSelectedMilestone().resources.splice(b,1);this.invalidResources=!(this.getSelectedMilestone().resources.length>0)},limitTextLength:function(a,b){var c=a.length;return c>b?a.substr(0,b-4)+".."+a.substr(c-4,c):a},updateMilestoneStatus:function(){for(var a=new Date,b=0;b<this.milestones.length;b++){var c=f(a).diff(f(this.milestones[b].end),"days");this.milestones[b].status="progress",c<3&&1!==this.milestones[b].progress&&(this.milestones[b].status="urgent"),c>0&&1!==this.milestones[b].progress&&(this.milestones[b].status="missed"),1===this.milestones[b].progress&&(this.milestones[b].status="ready"),1===this.milestones[b].progress&&this.milestones[b].reflections.length>0&&(this.milestones[b].status="reflected")}},toggleReflectionsForm:function(){this.reflectionsFormVisisble=!this.reflectionsFormVisisble,console.log(this.reflectionsFormVisisble)},validateReflectionForm:function(){for(var a=!0,b=this.getSelectedMilestone().reflections,c=0;c<b.length;c++)0===b[c].length&&(a=!1);return 4===b.length&&a},submitReflections:function(){this.getSelectedMilestone().status="reflected"},setFilterPreset:function(a){var b=[],c=new Date;switch(this.filterPreset=a,a){case"today":b=[new Date(c.getTime()-2592e5),new Date(c.getTime()+2592e5)];break;case"last-week":b=[new Date(c.getTime()-6048e5),new Date(c.getTime()+864e5)];break;case"last-month":b=[new Date(c.getTime()-2592e6),new Date(c.getTime()+864e5)];break;case"semester":b=[new Date(2019,9,1,0,0,0,0),new Date(2020,2,31,23,59,59,0)]}this.timeFilterChart.replaceFilter(d.filters.RangedFilter(b[0],b[1])),this.timeFilterChart.filterTime()}}});r.setFilterPreset("semester");new k(b,g,r,h,n);window.onresize=function(a){l=document.getElementById("planing-component").offsetWidth,r.width=l-m.right,r.timeFilterChart.filterTime()}}};return c});