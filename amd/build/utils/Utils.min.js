/**
 * Javascript utils for the Moodle videodatabase
 *
 * @module     mod_videodatabase/videodatabase
 * @package    mod_videodatabase
 * @class      Utils
 * @copyright  2019 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @license    MIT
 * @since      3.1
 */
require.config({enforceDefine:!1,paths:{d3:[M.cfg.wwwroot+"/course/format/ladtopics/lib/src/d3.v4"],crossfilter:[M.cfg.wwwroot+"/course/format/ladtopics/lib/build/crossfilter.min"],dc:[M.cfg.wwwroot+"/course/format/ladtopics/lib/src/dc.v3"]},shim:{dc:{deps:["d3","crossfilter"]},crossfilter:{exports:"crossfilter"},d3:{exports:"d3"}}}),define(["jquery","core/ajax","d3","dc",M.cfg.wwwroot+"/course/format/ladtopics/amd/src/utils/ErrorHandler.js"],(function(t,e,r,a,o){return function(){this.namex="utils",this.d3=r,this.dc=a,o.logWindowErrors(),o.logConsoleErrors(),this.get_ws=function(r,a,i,n){n=void 0!==n&&n,e.call([{methodname:n?r:"format_ladtopics_"+r,args:a,done:function(e){e.hasOwnProperty("exception")?t("#alert").html("Die Prozedur "+r+" konnte nicht als Webservice geladen werden.<br>").append(JSON.stringify(e)):i(e)},fail:function(t){new o(t)}}])},this.germanFormatters=r.timeFormatDefaultLocale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d.%m.%Y",time:"%H:%M",periods:["",""],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jän","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),this.customTimeFormat=function(t){return t.getMinutes()?r.timeFormat("%I:%M")(t):t.getMilliseconds()?r.timeFormat(".%L")(t):t.getSeconds()?r.timeFormat(":%S")(t):t.getHours()?r.timeFormat("%Hh")(t):t.getDay()?r.timeFormat("%a %e.%m.")(t):t.getMonth()?r.timeFormat("%B")(t):r.getDate("%Y")},this.monthRange=[{num:1,name:"Januar"},{num:2,name:"Feburar"},{num:3,name:"März"},{num:4,name:"April"},{num:5,name:"Mai"},{num:6,name:"Juni"},{num:7,name:"Juli"},{num:8,name:"August"},{num:9,name:"September"},{num:10,name:"Oktober"},{num:11,name:"November"},{num:12,name:"Dezember"}],this.numberToWord=function(t,e){switch(e=void 0===e?"":e,t){case 0:return"kein"+e;case 1:return"ein"+e;case 2:return"zwei"+e;case 3:return"drei"+e;case 4:return"vier"+e;case 5:return"fünf"+e;case 6:return"sechs"+e;case 7:return"sieben"+e;case 8:return"acht"+e;case 9:return"neun"+e;case 10:return"zehn"+e;case 11:return"elf"+e;default:return t+" "+e}};const i=r.timeFormatLocale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d.%m.%Y",time:"%H:%M",periods:["",""],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]});this.formatMillisecond=i.format(".%L"),this.formatSecond=i.format(":%S"),this.formatMinute=i.format("%I:%M"),this.formatHour=i.format("%H:%M"),this.formatDay=i.format("%a %e.%m."),this.formatDate=i.format("%d.%m.%Y"),this.formatDateFull=i.format("%d.%m.%Y %H:%M"),this.formatDate2=i.format("%d/%m/%Y"),this.formatWeek=i.format("%b %d"),this.formatWeekNum=i.format("%U"),this.formatMonth=i.format("%B"),this.formatYear=i.format("%Y"),this.multiFormat=function(t){return r.timeSecond(t)<t?this.formatMillisecond:r.timeMinute(t)<t?this.formatSecond:r.timeHour(t)<t?this.formatMinute:r.timeDay(t)<t?this.formatHour:r.timeMonth(t)<t?r.timeWeek(t)<t?this.formatDay:this.formatWeek:r.timeYear(t)<t?this.formatMonth:this.formatYear},this.addFilterChart=function(t,e){var r=this.d3.scale.ordinal().domain([0]).range(["#e6550d"]),o=e.dimension((function(e){return e[t.indepVar]})),i=o.group().reduceSum((function(e){return+e[t.depVar]})),n=void 0===t.margins?{top:0,right:5,bottom:20,left:2}:t.margins,s=void 0===t.colors?r:t.colors,m="";switch(t.chartType){case"rowChart":(m=a.rowChart(t.selector)).xAxis().ticks(4),m.margins(n).height(130);break;case"pieChart":(m=a.pieChart(t.selector)).innerRadius(20).height(100)}m.dimension(o).group(i).colors(s).title((function(e){return[t.indepVar.charAt(0).toUpperCase(),t.indepVar.slice(1,t.indepVar.length),": ",e.key,"\n","Value: ",e.value].join("")})).label((function(e){return t.keys[e.key]||e.key})),this.register(m)},this.charts=[],this.register=function(t){this.charts.push(t)},this.resetCharts=function(){for(var t=0;t<this.charts.length;t++)this.charts[t].filterAll();a.redrawAll()},this.mergeObjects=function(t,e){var r={};for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);return r}}}));