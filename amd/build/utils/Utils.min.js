/**
 * Javascript utils for the Moodle videodatabase
 *
 * @module     mod_videodatabase/videodatabase
 * @package    mod_videodatabase
 * @class      Utils
 * @copyright  2019 Niels Seidel, niels.seidel@fernuni-hagen.de
 * @license    MIT
 * @since      3.1
 */
require.config({enforceDefine:!1,paths:{d3:[M.cfg.wwwroot+"/course/format/ladtopics/lib/src/d3.v4"],crossfilter:[M.cfg.wwwroot+"/course/format/ladtopics/lib/build/crossfilter.min"],dc:[M.cfg.wwwroot+"/course/format/ladtopics/lib/src/dc.v3"]},shim:{dc:{deps:["d3","crossfilter"]},crossfilter:{exports:"crossfilter"},d3:{exports:"d3"}}}),define(["jquery","core/ajax","d3","dc",M.cfg.wwwroot+"/course/format/ladtopics/amd/src/utils/ErrorHandler.js"],(function(e,t,r,a,o){return function(){this.namex="utils",this.d3=r,this.dc=a,o.logWindowErrors(),o.logConsoleErrors(),this.get_ws=function(r,a,i,n){n=void 0!==n&&n,t.call([{methodname:n?r:"format_ladtopics_"+r,args:a,done:function(t){t.hasOwnProperty("exception")?e("#alert").html("Die Prozedur "+r+" konnte nicht als Webservice geladen werden.<br>").append(JSON.stringify(t)):i(t)},fail:function(e){new o(e)}}])},this.germanFormatters=r.timeFormatDefaultLocale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d.%m.%Y",time:"%H:%M",periods:["",""],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jän","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),this.customTimeFormat=function(e){return e.getMinutes()?r.timeFormat("%I:%M")(e):e.getMilliseconds()?r.timeFormat(".%L")(e):e.getSeconds()?r.timeFormat(":%S")(e):e.getHours()?r.timeFormat("%Hh")(e):e.getDay()?r.timeFormat("%a %e.%m.")(e):e.getMonth()?r.timeFormat("%B")(e):r.getDate("%Y")},this.monthRange=[{num:1,name:"Januar"},{num:2,name:"Feburar"},{num:3,name:"März"},{num:4,name:"April"},{num:5,name:"Mai"},{num:6,name:"Juni"},{num:7,name:"Juli"},{num:8,name:"August"},{num:9,name:"September"},{num:10,name:"Oktober"},{num:11,name:"November"},{num:12,name:"Dezember"}],this.numberToWord=function(e,t){switch(t=void 0===t?"":t,e){case 0:return"kein"+t;case 1:return"ein"+t;case 2:return"zwei"+t;case 3:return"drei"+t;case 4:return"vier"+t;case 5:return"fünf"+t;case 6:return"sechs"+t;case 7:return"sieben"+t;case 8:return"acht"+t;case 9:return"neun"+t;case 10:return"zehn"+t;case 11:return"elf"+t;default:return e+" "+t}};const i=r.timeFormatLocale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d.%m.%Y",time:"%H:%M",periods:["",""],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]});this.formatMillisecond=i.format(".%L"),this.formatSecond=i.format(":%S"),this.formatMinute=i.format("%I:%M"),this.formatHour=i.format("%H:%M"),this.formatDay=i.format("%a %e.%m."),this.formatDate=i.format("%d.%m.%Y"),this.formatDate2=i.format("%d/%m/%Y"),this.formatWeek=i.format("%b %d"),this.formatWeekNum=i.format("%U"),this.formatMonth=i.format("%B"),this.formatYear=i.format("%Y"),this.multiFormat=function(e){return r.timeSecond(e)<e?this.formatMillisecond:r.timeMinute(e)<e?this.formatSecond:r.timeHour(e)<e?this.formatMinute:r.timeDay(e)<e?this.formatHour:r.timeMonth(e)<e?r.timeWeek(e)<e?this.formatDay:this.formatWeek:r.timeYear(e)<e?this.formatMonth:this.formatYear},this.addFilterChart=function(e,t){var r=this.d3.scale.ordinal().domain([0]).range(["#e6550d"]),o=t.dimension((function(t){return t[e.indepVar]})),i=o.group().reduceSum((function(t){return+t[e.depVar]})),n=void 0===e.margins?{top:0,right:5,bottom:20,left:2}:e.margins,s=void 0===e.colors?r:e.colors,m="";switch(e.chartType){case"rowChart":(m=a.rowChart(e.selector)).xAxis().ticks(4),m.margins(n).height(130);break;case"pieChart":(m=a.pieChart(e.selector)).innerRadius(20).height(100)}m.dimension(o).group(i).colors(s).title((function(t){return[e.indepVar.charAt(0).toUpperCase(),e.indepVar.slice(1,e.indepVar.length),": ",t.key,"\n","Value: ",t.value].join("")})).label((function(t){return e.keys[t.key]||t.key})),this.register(m)},this.charts=[],this.register=function(e){this.charts.push(e)},this.resetCharts=function(){for(var e=0;e<this.charts.length;e++)this.charts[e].filterAll();a.redrawAll()},this.mergeObjects=function(e,t){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return r}}}));